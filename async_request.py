import asyncio

#web
import grequests
from bs4 import BeautifulSoup as bs

#db
from sql_worker import sql_work


def exception_handler(request, exception):
    print(exception)


list_tasks = {}
async def parse_page(data, url):
    try:
        soup = bs(data, 'lxml')
        find_bs4 = soup.find('title')
        list_tasks.update({url:find_bs4.text.strip()})
    except AttributeError:
        print(url, 'has no text!')

async def main():

    #Page list может быть получен, например из базы (например, если пользователи загружают списки страниц для сбора с них данных)
    page_list = [
            'http://www.omax.ru',
'http://www.akkond.ru',
'http://www.trudeks.ru',
'http://www.ppot.ru',
'http://www.oaomoek.ru',
'http://www.lottehotelvladivostok.com',
'http://tavrida.com',
'http://www.boesconstruction.com/',
'https://ecocity26.ru',
'http://www.oilgazholding.ru',
'http://www.gelar.ru',
'http://www.krasnoe-beloe.ru',
'http://rabota.polyusgold.com',
'http://www.tbm.ru',
'http://www.metadynea.ru',
'http://rabota.leroymerlin.ru',
'http://www.colvir.com',
'http://www.badenelit.org',
'http://www.pulkovo-cargo.ru',
'http://www.niva.su',
'http://www.mkm.ru',
'http://volga-ice.ru',
'http://www.rabotavamrest.ru',
'http://www.kareliaupofloor.ru',
'http://www.ontexglobal.com/',
'http://www.sulzer.com',
'http://www.dbschenker.ru',
'http://www.roadgr.ru/',
'http://lesavik.ru/',
'http://zerdefito.kz',
'http://www.smurfitkappa.com/vHome/ru',
'http://www.spektr-bc.ru/about/',
'http://www.agah.ru',
'http://www.ancor.ru',
'http://www.quarryservice.ru',
'http://www.isuzu.ru',
'http://www.grasys.ru/korporativnaya-zhizn-i-rabota-v-grasis/',
'http://www.vympel.group/',
'http://www.i-teco.ru',
'http://teamuz.ru/',
'http://www.vkcomfort.ru',
'http://pepsico.ru',
'http://',
'http://tzgsho.ru/',
'http://www.vnipineft.ru',
'http://www.stopexpress.ru',
'http://www.olk.su',
'http://www.ktits.ru',
'http://www.fine-people.ru/',
'http://noone.ru',
'http://endopharm.ru',
'http://www.midas.com.ru',
'http://www.groupm.com',
'http://sfera-invest.com',
'http://www.ingos.ru',
'http://www.itecorp.ru',
'http://cekport.ru/',
'http://www.ktzholding.com',
'http://rbpi.no',
'http://www.kamaz.ru',
'http://www.unilever.ru',
'http://www.mts.ru',
'http://plm.by',
'http://volgofarm.ru',
'http://www.nokiantyres.ru/nokian-tyres-family-ru',
'http://www.nestle.com',
'http://blockmaster.com.ua',
'http://www.tablogix.ru',
'http://www.phoenixcontact.ru',
'http://www.avriogroup.ru',
'http://www.pewete.com',
'http://www.smu4ufa.ru',
'http://soyuzmultfilm.ru',
'http://www.psbank.ru/job',
'http://кспб-3.рф',
'http://www.azsgazprom.ru',
'https://www.arvato.com/ru-ru.html',
'http://dshi10.udm.muzkult.ru/',
'http://www.sibur.ru',
'https://www.rabotauuaz.ru',
'http://www.leaderteam.ru/',
'http://www.mrdoors.ru',
'http://www.rosneft.ru',
'http://fss.su',
'http://www.detskoselsky.ru',
'http://glavstroy.ru/about/today.html',
'http://www.tsk-mosenergo.ru',
'http://www.icdc.ru',
'https://www.samberi.com/',
'http://fortex-kazan.ru',
'http://www.vivadengi.ru/',
'http://www.gazprom-neft.ru',
'http://www.don-polymer.ru',
'http://www.sotex.ru',
'http://lamor-u.ru',
'http://www.yandex.ru',
'http://tomlesdrev.ru',
'http://www.serconsrus.ru',
'http://трудэксперт.рф',
'http://www.gefco.net/',
'http://www.ckbm.ru',
'http://airastana.com',
'http://www.mechel.com',
'http://www.lat.spb.ru',
'http://www.rbegroup.ru',
'http://www.sibset.ru/',
'http://www.stis.ru',
'http://www.kleverltd.ru',
'http://www.zti.ru',
'http://www.wildberries.ru',
'http://www.cityexpress.ru',
'http://sportedu.ru',
'http://www.ponyexpress.ru',
'http://www.krost-concern.ru/',
'http://www.regionsgroup.ru',
'http://ipigaz.ru',
'http://www.ikea.ru',
'http://sibgenco.ru/',
'http://www.n-azot.ru',
'http://www.oootmt.by',
'http://www.omk.ru',
'http://atek-group.ru',
'http://rabota.terracorp.ru',
'http://www.egoza.biz',
'http://www.kfneva.ru',
'http://www.nsgc.ru/',
'http://www.artpalitra.by',
'http://www.apk-agroeco.ru/',
'http://m-invest.ru',
'http://www.pudov.ru',
'http://fortum.ru',
'http://1b.ru',
'http://www.bgsp.ru',
'http://gorkygorod.ru/',
'http://www.hcfe.ru',
'http://www.zyfra.com/',
'http://www.psm-hydraulics.ru',
'http://www.claas.ru',
'http://fransabank.by/',
'http://www.sgc.ru',
'http://aemtech.ru/',
'http://aviakor.ru',
'http://www.yit-mo.ru/',
'http://www.ghgt.ru',
'http://www.kellyservices.ru',
'http://stimul.dp.ua',
'http://enginecareers.com/',
'http://www.mkstroy.com',
'http://spectron-ops.ru/',
'https://www.facebook.com/www.optimist.kz/',
'http://www.weatherford.ru',
'http://ccibt.at/',
'http://www.renault.ru',
'http://www.arts-museum.ru',
'http://www.rencons.com',
'http://www.erg.kz',
'http://www.antalrussia.ru',
'http://maison-dellos.com',
'http://www.a2service.com',
'http://www.infra.ru/',
'http://www.titan2.ru',
'http://dns-shop.ru',
'http://rental-engineering.ru/',
'http://wirquin.ru/',
'http://sibagrogroup.ru',
'http://www.kentech.ie',
'http://www.uniconf.ru/',
'http://www.agroinvest.com',
'http://www.russianpost.ru',
'http://www.barona.ru',
'http://www.ilimgroup.ru',
'http://www.beeline.ru',
'http://www.burgaz.ru',
'http://www.sngb.ru',
'http://vodokanal-nn.ru',
'http://www.mondijobs.ru',
'http://www.aston.ru',
'https://key-g.com/',
'http://veropharm.ru',
'http://okna-kpi.ru/',
'http://synterra-group.ru/synterra-construction/',
'http://www.victoria-group.ru',
'http://www.ews.ru',
'http://agrico.ru',
'http://www.komus.org',
'http://www.rodinaeg.com',
'http://www.etam.com',
'http://dbxim.ru/',
'http://belugagroup.ru',
'http://www.metkomp.ru/',
'http://www.goz.ru/',
'http://metallprofil.kz',
'http://mosgortur.ru/',
'http://www.alvisa.ru',
'http://naykalab.ru',
'http://www.diageo.com',
'http://www.chefmarket.ru',
'http://mrtexpert.ru',
'http://sk-kristall.ru/',
'http://www.polati.ru',
'http://www.omc.ru',
'http://www.aecom.com',
'http://www.s2b.ru',
'http://www.mrsk-sib.ru/index.php?lang=ru42',
'http://lindstrom.ru',
'http://gbuns.kvado.ru',
'http://oxrapro.ru',
'http://www.mbcon.ru/',
'http://www.vnukovo.ru',
'http://www.akmeservices.ru',
'http://www.fuyaogroup.com',
'http://www.human-capital.ru',
'http://knauf-penoplast.ru',
'http://mangazeya.ru/',
'http://www.corpkometa.ru/',
'http://www.energo-profi.ru/about/',
'http://www.gseis.ru/',
'http://www.russianstandard.com',
'http://www.irvik.ru',
'http://www.gk-vladar.ru/',
'http://rmntk-ts.ru',
'http://www.est-tver.ru/',
'http://www.rusoil72.ru/',
'http://avangard-agro.ru/about/',
'http://ecostandardgroup.ru',
'http://www.saint-gobain.ru',
'http://www.mav.by',
'http://www.baltmeridian.ru',
'http://www.texha.ru',
'http://www.lenenergo.ru',
'http://www.phosagro.ru',
'http://www.sberbank-talents.ru',
'http://www.avtoline.ru',
'http://invivo.kz',
'http://www.moneks.ru',
'http://www.zenit.ru',
'http://www.unas.ru',
'http://osk1520.ru',
'http://www.mercury.ru',
'http://www.ruslab.org',
'http://www.balttex.ru',
'http://www.starkgroup.ru',
'http://sk-interpol.ru/',
'http://www.frostel.ru/',
'https://www.ericsson.ru',
'http://gk-dom-stroy.ru',
'http://www.absrealty.ru',
'http://vapc.ru/',
'http://www.bngf.ru',
'https://ekb.esplus.ru',
'http://www.scsbm.ru/company',
'https://nordgoldjobs.com/',
'http://www.etsgp.ru',
'http://www.gvgold.ru',
'http://spbu.ru',
'http://www.format-corp.com/',
'http://jobs.danfoss.com/russia',
'http://mrts.ru',
'http://www.orelstroy.ru/',
'http://www.ohranatrud.ru',
'http://www.rgtk.ru/rgtk_history',
'http://www.sanatory-mashuk.ru',
'http://www.vost-tech.ru',
'http://regionspb.net',
'http://www.krka.ru',
'http://www.tn.ru',
'http://www.iml.ru',
'http://www.nskavtodor.ru/',
'http://olympcg.ru',
'http://www.umecon.ru',
'http://www.rusagrogroup.ru',
'https://www.himstalcon.ru/',
'http://www.spectrum-group.ru',
'http://profiklass.ru/',
'http://www.stallmarket.ru',
'http://www.semya.perm.ru',
'http://vsgroups.ru',
'http://эко-хлеб.рф',
'http://www.penoplex.ru',
'https://jobs.lamoda.ru/',
'http://www.suenco.ru',
'http://comitas.ru',
'http://www.fesco.ru',
'http://www.toyota.ru/about/factory.tmex',
'http://agroprof.com/',
'http://www.germesgroup.com',
'http://www.avsgroup.ru',
'http://aliance-slv.ru/',
'http://www.regionpersonal.ru',
'http://mostra.by',
'http://mosintrast.ru',
'http://www.jobazbuka.ru',
'http://www.rss-fasad.ru/',
'http://www.X5.ru',
'http://www.prom-eco.com',
'http://Кубаньэкопродукт.рф',
'https://www.bazis-uc.ru/',
'http://www.bi-group.kz',
'http://www.camozzi.ru',
'http://relero.ru',
'http://www.estacons.com',
'http://www.zaogsp.ru',
'https://centrofinans.ru/',
'http://president-msk.ru',
'http://kkskr.ru',
'https://pozitivtelecom.ru',
'http://www.magnum.kz',
'http://www.rezalit-s.ru',
'http://www.grandline.ru',
'http://liavinet.ru',
'https://osnovap.ru/?utm_source=hh&utm_medium=profile&utm_campaign=1',
'http://www.sgmao.ru',
'http://www.eos-solutions.ru/',
'http://business-info.by',
'http://www.primbank.ru',
'http://www.green-market.by',
'http://www.technoplast.msk.ru',
'http://www.p-krsk.ru',
'http://www.carlsbergkazakhstan.kz',
'http://www.hays.ru',
'http://velikan-company.ru',
'http://www.ruselectronics.ru',
'http://korona.by',
'http://intek-tool.ru/',
'http://www.tgtoil.com/',
'https://www.unity.ru/',
'http://www.hoztorgvrn.ru',
'http://www.ka-phenix.ru',
'http://chistovod.by/',
'http://www.grinn-corp.ru',
'http://samoletgroup.ru',
'http://www.speechpro.com',
'http://www.kpo.kz',
'http://simsolu.ru/',
'http://www.omz.ru',
'http://www.rpsgglobal.com/',
'http://krymtec.com',
'https://ao-ustek.ru',
'http://www.tbng.ru',
'http://www.e-vent.by',
'http://intratool.com',
'http://www.karaway.ru/',
'http://www.aster-auto.kz/',
'https://crystallm.com/',
'http://sperton.com',
'http://www.knakits.ru',
'http://sibagroholding.ru/',
'http://www.irkutskoil.ru',
'http://tachoservice.by/',
'http://www.loder.ru',
'http://www.kazminerals.com/ru/our_people/search_apply',
'http://www.hlebnitca.ru',
'http://www.kavgaz.ru',
'https://www.pao8.ru/',
'https://www.dominos.by/job',
'http://www.lgss-spb.ru',
'http://cckgroup.ru',
'http://oboronenergo.su',
'http://gold-product.com',
'http://www.zavodbt.ru',
'http://www.pskovvtormet.ru',
'http://sputnic.ru',
'http://www.highvill.kz',
'https://amjgroup.ru/about-us',
'http://euracor.ru',
'http://www.atsenergo.ru',
'http://www.mercedes-benz.ru',
'http://www.donutsandcoffee.ru',
'http://www.spp.ru',
'http://www.fix-price.ru',
'http://kz-systems.com/',
'http://www.bls.ru',
'http://www.btcgroup.ru',
'http://www.holidayinn.com',
'https://pravdacoffee.ru/',
'http://www.tetrastroy.net',
'http://www.teplocom-holding.ru',
'http://coca-colahellenic.ru/Careers/',
'http://www.flotnmtp.ru',
'http://www.alkorbio.ru',
'http://www.danone.ru',
'http://www.1tvch.ru',
'http://offprice.eu',
'http://www.rubexgroup.ru',
'http://stroi-avf.ru',
'http://www.agrigo.ru',
'http://betonbrut.ru',
'http://avokzal63.ru',
'http://www.megafon.ru',
'http://almi.by',
'http://bvsz.ru/index.php/kont.html',
'http://www.p-3.su',
'http://www.beko.ru',
'http://job.mosmetro.ru/',
'http://www.stream.ru',
'http://nakedchef.ru',
'http://www.rshotel.ru',
'http://www.mcclinics.ru',
'http://www.belryba.by',
'http://www.kupivip.ru',
'http://www.novatek.ru',
'http://usi23.ru',
'http://fpc.ru',
'http://www.sol-russia.com',
'http://www.dukon.ru',
'http://www.henkel.ru',
'http://apexplus.ru/',
'http://www.gzmk.ru',
'http://www.kraft-pk.ru',
'http://www.gipvn.ru',
'http://www.rzdstroy.ru',
'http://www.vizavi.ru',
'http://medcomis.ru',
'http://scraft.spb.ru',
'http://saturn3.ru/',
'http://gkosnova.ru',
'http://www.vsk.ru',
'http://www.cersanit.ru',
'http://www.psbst.ru',
'http://www.fpb.su',
'http://www.t-s-c.ru/',
'http://www.rtinform.ru',
'https://www.villagio.ru',
'http://www.miratorg.ru',
'https://kitchen.slotex.ru/about',
'http://www.bella-tzmo.ru',
'http://shokolend.ru',
'http://www.avtoban-dsk.com',
'http://www.gppedok.ru',
'http://mosgortrans.ru',
'http://www.volgogaz.ru',
'http://www.nissan.ru',
'http://54.rospotrebnadzor.ru',
'http://alivaria.by',
'http://www.nordwindairlines.ru/',
'http://leskraft.ru/',]

    rs = []
    for p in page_list:
        rs.append(grequests.get(p, timeout=10))
    iter_rs = grequests.imap(rs, size=len(page_list), exception_handler=exception_handler)


    for page in iter_rs:
        task = asyncio.create_task(parse_page(page.text, page.url))
        await asyncio.gather(task)

if __name__ == '__main__':
    asyncio.run(main())
    sql_work(list_tasks)